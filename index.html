<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-L">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Joke Generator</title>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Almendra+SC&family=Anton&family=Comic+Relief:wght@400;700&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Oswald:wght@200..700&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Rubik+Bubbles&family=Story+Script&display=swap');
    .cjgt{
        text-align: center;
        font-family: 'Rubik Bubbles';
        color:lightgrey;
        outline: black;
        font-size: 2.5rem; /* Added for better mobile view */
        text-shadow:
        /* top-left shadow */
        -2px -2px 0 #000, 
        /* top-right shadow */
        2px -2px 0 #000,
        /* bottom-left shadow */
        -2px 2px 0 #000,
        /* bottom-right shadow */
        2px 2px 0 #000;
        
    }

    /* This creates the scrolling animation */
    @keyframes infinite-scroll {
    0% {
      background-position: 0 0;
    }
    100% {
        /* This scrolls the background diagonally. 
        You can change 500px to be bigger or smaller! */
        background-position: -500px -500px;
    }
 }

 body {
    /* This is your background image */
    background-image: url("img/background.jpg"); /* Assumes you have this image */
  
    /* This tells it to repeat, which you already have */
    background-repeat: repeat;
    /* FIXED: Removed 'background-size: cover;' */
  
    /* This applies the infinite animation! */
    animation: infinite-scroll 30s linear infinite;
 }


 .card{
    /* Use max-width to be responsive */
    max-width: 500px; 
    width: 90%; /* Works well on mobile */
    /* Set min-height so it can grow */
    min-height:210px; 
    background-color:tan ;
    text-align: center;
    padding: 20px;
    margin: 0 auto; 
    border-radius: 8px;
    box-sizing: border-box; /* Good practice */
 }
 #input{
    border-radius: 5px;
    border: none;
    width: 100%; /* Make it responsive */
    max-width: 300px; /* But not too big */
    height:50px;
    text-align: center;
    box-sizing: border-box; /* Good practice */
 }
 
 .sub_buttn{
    border-radius: 3px;
    border:black;
    background-color:greenyellow;
    height:30px;
    width:80px;
    cursor: pointer; /* Good to add for buttons */
 }

 /* This is our new "stage" for the joke */
 #joke-display {
    font-family: 'Comic Relief', cursive;
    font-size: 1.25rem;
    color: #333;
    margin-top: 15px;
    min-height: 50px; /* Gives space for the joke */
    line-height: 1.4;
 }

</style>



<body>
    <div class="content">
        <div class="title">
            <h1 class="cjgt">Christmas Joke Generator!</h1>
        </div>
        <br>
        <br>
        <br>
        <br>
        <br>
        <div class="card">
            <h3 class="c_html", id="c_html">Search for a joke (one word)</h3>
            <br>
            <input type="text" name="prom_input" id="input", placeholder="e.g., 'Santa' or 'snowman'">
            <br>
            <br>
            <!-- FIXED: Changed 'onclick' and added 'event' -->
            <button type="submit", id="submit_button", class="sub_buttn", onclick="button_clicked(event)">Submit</button>
            
            <!-- NEW: This is the "stage" for our joke -->
            <p id="joke-display"></p>
        </div>
    </div>

    <script>
        // FIXED: Make the function 'async' and pass 'event'
        async function button_clicked(event){
            // FIXED: Stop the page from reloading
            event.preventDefault(); 

            const baseUrl = "https://v2.jokeapi.dev/joke/Christmas?contains="
            const header = document.getElementById("c_html");
            const input = document.getElementById("input");
            const jokeDisplay = document.getElementById("joke-display"); // Get the joke stage
            
            const in_val = encodeURIComponent(input.value);
            
            // If the user types nothing, just get any Christmas joke
            let full_api;
            if (in_val.trim() === "") {
                full_api = "https://v2.jokeapi.dev/joke/Christmas";
            } else {
                full_api = baseUrl + in_val;
            }

            // Let the user know we are searching...
            jokeDisplay.innerHTML = "Finding a great joke...";

            try {
                // FIXED: 'await' the fetch() call
                const response = await fetch(full_api);
                
                // FIXED: 'await' the .json() (opening the box)
                const data = await response.json();

                console.log(data); // See the full response in the console!

                // Check if the API gave us an error
                if (data.error) {
                    jokeDisplay.innerHTML = "Couldn't find a joke with that word! Try another?";
                } 
                // Check if it's a "twopart" joke
                else if (data.type === "twopart") {
                    jokeDisplay.innerHTML = `${data.setup}<br>...<br>${data.delivery}`;
                } 
                // Check if it's a "single" part joke
                else {
                    jokeDisplay.innerHTML = data.joke;
                }

            } catch (error) {
                console.error("Error fetching joke:", error);
                jokeDisplay.innerHTML = "Something went wrong! Please try again.";
            }
        }
    </script>
</body>
</html>